>
  {# Morning Report #}
  {%- macro getReport() -%}
    <p>
      {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 6 %}
        Good morning.
      {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
        Good afternoon.
      {% else %}
        Good evening.
      {% endif %}
      </p>
      <p>
      {% if now().strftime('%H')|int < 12 %}
        {% if now().strftime('%M')|int == 0 %}
          It is {{ now().strftime('%H')|int }} AM.
        {% else %}
          It is {{ now().strftime('%H')|int }} {{ now().strftime('%M')|int }} AM.
        {% endif %}

      {% elif now().strftime('%H')|int > 12 %}
        {% if now().strftime('%M')|int == 0 %}
          It is {{ now().strftime('%H')|int }} PM.
        {% else %}
          It is {{ now().strftime('%H')|int }} {{ now().strftime('%M')|int }} PM.
        {% endif %}
      
      {% else %}

      {% endif %}
      </p>
      <p>
      {{ [
          'Today is ',
          'If you have not been keeping track today is ',
          'Do you know what day of the week it is? Today is',
          'I hate to be the bearer of bad news, but today is '
      ]|random }}
      {{states.sensor.today_is.state }}.
      </p>
      <p>
        It is currently {{states.weather.iron_nerd_weather_station.state}} and {{states.sensor.pirateweather_temperature.state|round}} degrees in Defiance. 
      </p>
      <p>
        {% if states('sensor.weatheralerts_active_alerts') > '0' %}
          "Currently there are weather alerts active. The total number of alerts is {{ states('sensor.weatheralerts_active_alerts') }}. They are as follows. "
            {% if is_state('sensor.weatheralerts_alert_1','on') %}
              "{{ state_attr('sensor.weatheralerts_alert_1','alert_event') }}"
            {% endif %}
            {% if is_state('sensor.weatheralerts_alert_2','on') %}
              "{{ state_attr('sensor.weatheralerts_alert_2','alert_event') }}"
            {% endif %}
            {% if is_state('sensor.weatheralerts_alert_3','on') %}
              "{{ state_attr('sensor.weatheralerts_alert_3','alert_event') }}"
            {% endif %}
            {% if is_state('sensor.weatheralerts_alert_4','on') %}
              "{{ state_attr('sensor.weatheralerts_alert_4','alert_event') }}"
            {% endif %}
            {% if is_state('sensor.weatheralerts_alert_5','on') %}
              "{{ state_attr('sensor.weatheralerts_alert_5','alert_event') }}"
            {% endif %}
        {% endif %}
      </p>
      <p>
        {{ [
            'The rest of the day should be,',
            'Todays forecast should be ,'
        ]|random }}
          {{ states.sensor.current_forecast.state }} 
        </p>
        <p>
        {% if is_state('sensor.halloween_countdown','0') %}
          Happy Halloween!
        {% endif %}
        {% if is_state('sensor.christmas_countdown','0') %}
          Merry Christmas Everyone!
        {% endif %}
        {% if is_state('sensor.anniversary_wedding_anniversary','0') %}
          Happy Anniversary! It been an amazing {{ states.sensor.anniversary_wedding_anniversary.attributes.years }} years!
        {% endif %}
        {% if is_state('calendar.holidays_in_united_states', 'on') %}
          Today is {{states.calendar.holidays_in_united_states.attributes.message}}. 
        {% endif %}
        {% if states.calendar.birthdays.state == 'on' %}
          Today is {{ states.calendar.birthdays.attributes.message }}! So Happy Birthday! The confetti cannon is not working otherwise I would shower you in paper garbage that someone else would have to pick up.
        {% endif %}
        {%- set event=states.calendar.national_holidays.attributes.message %}
        {% if 'Day' in event and 'National' in event%}
          {{ [
            'And a very special Happy ',
            'It is also ',
            'Today is also known as ',
            'Oh <emphasis>Look</emphasis>. Today is ',
            'Want to know a fact? Today is ',
            'Everyday can be a holiday. So today is '
        ]|random }}
        {{states.calendar.national_holidays.attributes.message | replace("&"," and ") }}.
        {%- endif -%}
        </p>
        <p>
          {% if now().strftime('%Y-%m-%d') == states.input_datetime.school_last_day.state %}
            Congratulations, today is the last day of school! Have an awesome day!
          {% endif %}
        </p>
        <p>

          {% if is_state('input_boolean.school_today','on') and is_state('input_boolean.work_today','on') %}
            {% set diff = (state_attr('input_datetime.tina_workday_start','timestamp') - state_attr('input_datetime.school_day_start','timestamp')) %}
            {%- if states.sensor.home_to_school.state|round > 12 %}
              Traffic to the school appears heavier than normal.
            {% else %}
              Traffic to the school is normal.
            {% endif %}
            Currently it will take {{states.sensor.home_to_school.state|round}} minutes to get to the school.
            {%- if diff <= 3600 %}
              {%- if states.sensor.school_to_bob_evans.state|round > 15 %}
                Traffic from the school to Bob Evans appears heavier than normal.
              {% else %}
                Traffic from the school to Bob Evans is normal.
              {% endif %}
              Currently it will take {{states.sensor.school_to_bob_evans.state|round}} minutes to get to Bob Evans from the school.
            {% endif %}
          {% elif is_state('input_boolean.work_today','on') %}
            {%- if states.sensor.home_to_bob_evans.state|round > 8 %}
              Traffic to Bob Evans appears heavier than normal.
            {% else %}
              Traffic to Bob Evans is normal.
            {% endif %}
            Currently it will take {{states.sensor.home_to_bob_evans.state|round}} minutes to get to Bob Evans.
          {% elif is_state('input_boolean.school_today','on') %}
            {%- if states.sensor.home_to_school.state|round > 12 %}
              Traffic to the school appears heavier than normal.
            {% else %}
              Traffic to the school is normal.
            {% endif %}
            Currently it will take {{states.sensor.home_to_school.state|round}} minutes to get to the school.
          {% else %}
            It appears no traffic reports are needed today. Enjoy your day off!
          {% endif %}

      <p>
        {% if is_state('sensor.garbage_collection_large_pickup','1') %}
          'Tomorrow is the monthly unlimited garbage pickup. Make sure to take out all large garbage items tonight, and do not forget the trash can!'
        {% elif is_state('sensor.garbage_collection','1') %}
          {{ [
          'Do not forget to take the trash bin to the curb, tomorrow is trash pickup day.',
          'Make sure to take the trash out. No, I do not mean Tony.',
          'Tomorrow is a big day for the garbage men. Make sure you do not let them down! Take the trash out!'
          ] | random }}
        {% endif %}

        {% set gc = state_attr('sensor.garbage_collection','days') %}
        {% if gc == 7 %}
          {{ [
          'Do not forget to bring the trash can back from the curb.',
          'The trash can will feel lonely if you leave it at the curb all night.'
          ] | random }}
        {% elif gc == 6 %}
          {{ [
          'If you have not already, please remember to bring the garbage can back from the sidewalk.',
          'Just in case you forgot, it is time to bring the garbage can back to the house before it gets lonely.'
          ] | random }}
        {% endif %}
      </p>

      <p>
        {% if is_state('sensor.michigan_wolverines','PRE') %}
          {% set date = state_attr('sensor.michigan_wolverines','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Michigan Wolverines will be playing today against the {{ state_attr('sensor.michigan_wolverines','opponent_name') }} at {{ state_attr('sensor.michigan_wolverines','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.michigan_wolverines','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.ohio_state_buckeyes','PRE') %}
          {% if state_attr('sensor.ohio_state_buckeyes','opponent_abbr') not in ['MICH'] %}
            {% set date = state_attr('sensor.ohio_state_buckeyes','date') | as_timestamp | timestamp_custom('%m-%d') %}
            {% if date == now().strftime('%m-%d') %}
              "The Ohio State Buckeyes will be playing today against the {{ state_attr('sensor.ohio_state_buckeyes','opponent_name') }} at {{ state_attr('sensor.ohio_state_buckeyes','venue') }}. "
              "Kickoff will be at {{ state_attr('sensor.ohio_state_buckeyes','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
            {% endif %}
          {% endif %}
        {% endif %}
        {% if is_state('sensor.toledo_rockets','PRE') %}
          {% set date = state_attr('sensor.toledo_rockets','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Toledo Rockets will be playing today against the {{ state_attr('sensor.toledo_rockets','opponent_name') }} at {{ state_attr('sensor.toledo_rockets','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.toledo_rockets','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.minnesota_vikings','PRE') %}
          {% set date = state_attr('sensor.minnesota_vikings','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Minnesota Vikings will be playing today against the {{ state_attr('sensor.minnesota_vikings','opponent_name') }} at {{ state_attr('sensor.minnesota_vikings','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.minnesota_vikings','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.san_francisco_49ers','PRE') %}
          {% set date = state_attr('sensor.san_francisco_49ers','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The San Francisco 49ers will be playing today against the {{ state_attr('sensor.san_francisco_49ers','opponent_name') }} at {{ state_attr('sensor.san_francisco_49ers','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.san_francisco_49ers','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.cleveland_guardians','PRE') %}
          {% set date = state_attr('sensor.cleveland_guardians','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Cleveland Guardians will be playing today against the {{ state_attr('sensor.cleveland_guardians','opponent_name') }} at {{ state_attr('sensor.cleveland_guardians','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.cleveland_guardians','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.minnesota_twins','PRE') %}
          {% set date = state_attr('sensor.minnesota_twins','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Minnesota Twins will be playing today against the {{ state_attr('sensor.minnesota_twins','opponent_name') }} at {{ state_attr('sensor.minnesota_twins','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.minnesota_twins','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.minnesota_twins','PRE') %}
          {% set date = state_attr('sensor.minnesota_twins','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Minnesota Twins will be playing today against the {{ state_attr('sensor.minnesota_twins','opponent_name') }} at {{ state_attr('sensor.minnesota_twins','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.minnesota_twins','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.los_angeles_dodgers','PRE') %}
          {% set date = state_attr('sensor.los_angeles_dodgers','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% if date == now().strftime('%m-%d') %}
            "The Los Angeles Dodgers will be playing today against the {{ state_attr('sensor.los_angeles_dodgers','opponent_name') }} at {{ state_attr('sensor.los_angeles_dodgers','venue') }}. "
            "Kickoff will be at {{ state_attr('sensor.los_angeles_dodgers','date') | as_timestamp | timestamp_custom('%I:%M %p') }}. "
          {% endif %}
        {% endif %}
      </p>

      <p>
        {% if is_state('sensor.michigan_wolverines','POST') %}
          {% set date = state_attr('sensor.michigan_wolverines','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.michigan_wolverines','team_score') | int) > (state_attr('sensor.michigan_wolverines','opponent_score') | int) %}
              "The Michigan Wolverines won their game yesterday against the {{ state_attr('sensor.michigan_wolverines','opponent_name') }} by a score of {{ state_attr('sensor.michigan_wolverines','team_score') }} to {{ state_attr('sensor.michigan_wolverines','opponent_score') }}. "
            {% else %}
              "The Michigan Wolverines lost their game yesterday against the {{ state_attr('sensor.michigan_wolverines','opponent_name') }} by a score of {{ state_attr('sensor.michigan_wolverines','opponent_score') }} to {{ state_attr('sensor.michigan_wolverines','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.michigan_wolverines','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.ohio_state_buckeyes','POST') %}
          {% if state_attr('sensor.ohio_state_buckeyes','opponent_abbr') not in ['MICH'] %}
            {% set date = state_attr('sensor.ohio_state_buckeyes','date') | as_timestamp | timestamp_custom('%m-%d') %}
            {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
            {% if yday == date %}
              {% if (state_attr('sensor.ohio_state_buckeyes','team_score') | int) > (state_attr('sensor.ohio_state_buckeyes','opponent_score') | int) %}
                "The Ohio State Buckeyes won their game yesterday against the {{ state_attr('sensor.ohio_state_buckeyes','opponent_name') }} by a score of {{ state_attr('sensor.ohio_state_buckeyes','team_score') }} to {{ state_attr('sensor.ohio_state_buckeyes','opponent_score') }}. "
              {% else %}
                "The Ohio State Buckeyes lost their game yesterday against the {{ state_attr('sensor.ohio_state_buckeyes','opponent_name') }} by a score of {{ state_attr('sensor.ohio_state_buckeyes','opponent_score') }} to {{ state_attr('sensor.ohio_state_buckeyes','team_score') }}. "
              {% endif %}
                "This brings their record to {{ state_attr('sensor.ohio_state_buckeyes','team_record') | replace("-"," and ") }} on the season. "
            {% endif %}
          {% endif %}
        {% endif %}
        {% if is_state('sensor.toledo_rockets','POST') %}
          {% set date = state_attr('sensor.toledo_rockets','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.toledo_rockets','team_score') | int) > (state_attr('sensor.toledo_rockets','opponent_score') | int) %}
              "The Toledo Rockets won their game yesterday against the {{ state_attr('sensor.toledo_rockets','opponent_name') }} by a score of {{ state_attr('sensor.toledo_rockets','team_score') }} to {{ state_attr('sensor.toledo_rockets','opponent_score') }}. "
            {% else %}
              "The Toledo Rockets lost their game yesterday against the {{ state_attr('sensor.toledo_rockets','opponent_name') }} by a score of {{ state_attr('sensor.toledo_rockets','opponent_score') }} to {{ state_attr('sensor.toledo_rockets','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.toledo_rockets','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.minnesota_vikings','POST') %}
          {% set date = state_attr('sensor.minnesota_vikings','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.minnesota_vikings','team_score') | int) > (state_attr('sensor.minnesota_vikings','opponent_score') | int) %}
              "The Minnesota Vikings won their game yesterday against the {{ state_attr('sensor.minnesota_vikings','opponent_name') }} by a score of {{ state_attr('sensor.minnesota_vikings','team_score') }} to {{ state_attr('sensor.minnesota_vikings','opponent_score') }}. "
            {% elif (state_attr('sensor.minnesota_vikings','team_score') | int) == state_attr('sensor.minnesota_vikings','opponent_score') | int %}
              "The Minnesota Vikings tied in their game yesterday against the {{ state_attr('sensor.minnesota_vikings','opponent_name') }} by a score of {{ state_attr('sensor.minnesota_vikings','team_score') }} to {{ state_attr('sensor.minnesota_vikings','opponent_score') }}. "
            {% else %}
              "The Minnesota Vikings lost their game yesterday against the {{ state_attr('sensor.minnesota_vikings','opponent_name') }} by a score of {{ state_attr('sensor.minnesota_vikings','opponent_score') }} to {{ state_attr('sensor.minnesota_vikings','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.minnesota_vikings','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.san_francisco_49ers','POST') %}
          {% set date = state_attr('sensor.san_francisco_49ers','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.san_francisco_49ers','team_score') | int) > (state_attr('sensor.san_francisco_49ers','opponent_score') | int) %}
              "The San Francisco 49ers won their game yesterday against the {{ state_attr('sensor.san_francisco_49ers','opponent_name') }} by a score of {{ state_attr('sensor.san_francisco_49ers','team_score') }} to {{ state_attr('sensor.san_francisco_49ers','opponent_score') }}. "
            {% elif (state_attr('sensor.san_francisco_49ers','team_score') | int) == state_attr('sensor.san_francisco_49ers','opponent_score') | int %}
              "The San Francisco 49ers tied in their game yesterday against the {{ state_attr('sensor.san_francisco_49ers','opponent_name') }} by a score of {{ state_attr('sensor.san_francisco_49ers','team_score') }} to {{ state_attr('sensor.san_francisco_49ers','opponent_score') }}. "
            {% else %}
              "The San Francisco 49ers lost their game yesterday against the {{ state_attr('sensor.san_francisco_49ers','opponent_name') }} by a score of {{ state_attr('sensor.san_francisco_49ers','opponent_score') }} to {{ state_attr('sensor.san_francisco_49ers','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.san_francisco_49ers','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.cleveland_guardians','POST') %}
          {% set date = state_attr('sensor.cleveland_guardians','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.cleveland_guardians','team_score') | int) > (state_attr('sensor.cleveland_guardians','opponent_score') | int) %}
              "The Cleveland Guardians won their game yesterday against the {{ state_attr('sensor.cleveland_guardians','opponent_name') }} by a score of {{ state_attr('sensor.cleveland_guardians','team_score') }} to {{ state_attr('sensor.cleveland_guardians','opponent_score') }}. "
            {% else %}
              "The Cleveland Guardians lost their game yesterday against the {{ state_attr('sensor.cleveland_guardians','opponent_name') }} by a score of {{ state_attr('sensor.cleveland_guardians','opponent_score') }} to {{ state_attr('sensor.cleveland_guardians','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.cleveland_guardians','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.minnesota_twins','POST') %}
          {% set date = state_attr('sensor.minnesota_twins','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.minnesota_twins','team_score') | int) > (state_attr('sensor.minnesota_twins','opponent_score') | int) %}
              "The Minnesota Twins won their game yesterday against the {{ state_attr('sensor.minnesota_twins','opponent_name') }} by a score of {{ state_attr('sensor.minnesota_twins','team_score') }} to {{ state_attr('sensor.minnesota_twins','opponent_score') }}. "
            {% else %}
              "The Minnesota Twins lost their game yesterday against the {{ state_attr('sensor.minnesota_twins','opponent_name') }} by a score of {{ state_attr('sensor.minnesota_twins','opponent_score') }} to {{ state_attr('sensor.minnesota_twins','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.minnesota_twins','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
        {% if is_state('sensor.los_angeles_dodgers','POST') %}
          {% set date = state_attr('sensor.los_angeles_dodgers','date') | as_timestamp | timestamp_custom('%m-%d') %}
          {% set yday = (as_timestamp(now()) - (24*3600)) | timestamp_custom('%m-%d') %}
          {% if yday == date %}
            {% if (state_attr('sensor.los_angeles_dodgers','team_score') | int) > (state_attr('sensor.los_angeles_dodgers','opponent_score') | int) %}
              "The Los Angeles Dodgers won their game yesterday against the {{ state_attr('sensor.los_angeles_dodgers','opponent_name') }} by a score of {{ state_attr('sensor.los_angeles_dodgers','team_score') }} to {{ state_attr('sensor.los_angeles_dodgers','opponent_score') }}. "
            {% else %}
              "The Los Angeles Dodgers lost their game yesterday against the {{ state_attr('sensor.los_angeles_dodgers','opponent_name') }} by a score of {{ state_attr('sensor.los_angeles_dodgers','opponent_score') }} to {{ state_attr('sensor.los_angeles_dodgers','team_score') }}. "
            {% endif %}
              "This brings their record to {{ state_attr('sensor.los_angeles_dodgers','team_record') | replace("-"," and ") }} on the season. "
          {% endif %}
        {% endif %}
      </p>

      <p>
        Here is a random dad joke <break time="1s"/> {{ states('sensor.random_joke') }}
      </p>

      <p>
        {% if is_state('input_boolean.briefing_extras','on') %}
          "And now we have the following extra information to pass along. {{ states('input_text.briefing_extras') }} "
        {% endif %}
      </p>

      </p>
  {%- endmacro -%}


  {# a macro that removes all newline characters, empty spaces, and returns formatted text  #}
    {%- macro cleanup(data) -%}
      {%- for item in data.split("\n")  if item | trim != "" -%}
        {{ item | trim }} {% endfor -%}
  {%- endmacro -%}

  {# a macro to call all macros :)  #}
    {%- macro mother_of_all_macros() -%}
      {{ getReport() }}
    {%- endmacro -%}
    
    {# Call the macro  #}
    {{- cleanup(mother_of_all_macros()) -}}