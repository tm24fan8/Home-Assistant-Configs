>
  {# Kallen Nightly Report #}
  {%- macro getReport() -%}
    <p>
      Good Evening, Collin, 
      {{ [ 'My sensors are detecting a strange smell. I am running diagnostics. But in the mean time, you should start a shower.',
          'It is a shower night, so you need to head upstairs and get on that.',
          'Did you ever hear the one about the kid who never took a shower? <break time="2s"/>Yeah, me either. So we should keep it that way. It is time to get ready for bed.',
          'It is almost bedtime. That means it is time to start preparing for bed.',
          'I hate to say it but, the day is coming to an end. Time to finish up your tasks, pick up any toys you have out, and get ready for bed.',
          'The count down clock until bedtime has started. Time to get cleaned up, get your pajamas on, and head for your bedroom.',
          'Its the final countdown <break time="2s"/> until bedtime, silly. Time to get ready to head that way!'
        ] | random }}
      {% if is_state('sensor.school_tomorrow', 'on') %} 
        {{ [ 'Because you have school tomorrow. ',
          'Because you have to get up early tomorrow for school.',
          'Because you want to be ready for school tomorrow.'
        ] | random }}
        {% if is_state('sensor.band_tomorrow','on') %}
          {{ [
            'And you have band practice in the morning. ',
            'And you have a date with a trombone first thing in the morning. ',
            'And you want to be nice and energetic for blowing into a large brass tube first thing in the morning. '
            ] | random }}
        {% endif %}
      {% else %}
        {% set month=states("sensor.date").split('-')[1] | int %}
        {%- if is_state('input_boolean.school_in_session', 'off') -%}
          {{ [ 'Looks like tomorrow is another day of summer vacation. ',
              'You are still on summer break tomorrow. ',
              'Summer vacation does not last forever, but it is not over yet. '
            ] | random }} 
        {% else %}
          Oh, and it appears you do not have school tomorrow
        {% endif %} 
          {{ [ 'so you can sleep in late. ',
              'so let us sleep a little later. ',
              ' so there is not a reason to get up early. ',
              'so we can sleep in. '
            ] | random }} 
      {% endif %} 
      {% if states.sensor.school_start_days2go.state | int < 10 and states.sensor.school_start_days2go.state | int > 1 -%}
        {{ [ 'I hate to say it, but ',
            'Unfortunately,',
            'All good things must come to an end.'
          ] | random }}
        There are only {{ states.sensor.school_start_days2go.state }} days  
        {{ [ 'left of summer vacation. ',
            ' left of summer break.',
            'Until School starts again.'
          ] | random }}
      {% elif states.sensor.school_start_days2go.state | int == 0 -%}
        Tomorrow is the first day of school. Are you ready? 
      {%- endif %}
      {% if states.sensor.thanksgiving_break_days2go.state | int <= 14 and states.sensor.thanksgiving_break_days2go.state | int > 0 %}
          {{ [ 'Oh, and look at that.',
          'For those trying to keep count. ',
          'In case you were wondering.',
          'Also, did you know.'
        ] | random }}
          There are only {{ states.sensor.thanksgiving_break_days2go.state }} days until Thanksgiving Break!
      {% endif %}
      {% if states.sensor.christmas_break_days2go.state | int <= 14 and states.sensor.christmas_break_days2go.state | int > 0 %}
          {{ [ 'Oh, and look at that.',
          'For those trying to keep count. ',
          'In case you were wondering.',
          'Also, did you know.'
        ] | random }}
          There are only {{ states.sensor.christmas_break_days2go.state }} days until Christmas Break!
      {% endif %}
      {% if states.sensor.spring_break_days2go.state | int <= 14 and states.sensor.spring_break_days2go.state | int > 0 %}
          {{ [ 'Oh, and look at that.',
          'For those trying to keep count. ',
          'In case you were wondering.',
          'Also, did you know.'
        ] | random }}
          There are only {{ states.sensor.spring_break_days2go.state }} days until Spring Break!
      {% endif %}
      {% if states.sensor.school_end_days2go.state | int < 15 and states.sensor.school_end_days2go.state | int > 0 -%}
      {{ [ 'School is almost over for the year.',
          'You have made it to the end of the school year.',
          'You are almost done with school.'
        ] | random }}
      There are only {{ states.sensor.school_end_days2go.state }} days  
      {{ [ 'left in the school year ',
          ' left of school.',
          'Until the last day of school.'
        ] | random }}
      {% elif states.sensor.school_end_days2go.state | int == 0 -%}
        Tomorrow is the first day of summer. Are you ready? 
      {%- endif %}
        {{ [ 'I will turn on your bedroom lights and appropriate white noise device at bedtime.',
          'I have executed the Pre bed routine for your room. Standby for bedtime protocol in two zero minutes.',
          'I will prepare your bedroom shortly.'
        ] | random }}
    </p>

    <p>
      Just for you, here is a random dad joke <break time="1s"/> {{ states('sensor.random_joke') }}
    </p>

    <p>
      {% if is_state('input_boolean.kallen_briefing_extras','on') %}
        "And now we have the following extra information to pass along. {{ states('input_text.kallen_briefing_extras') }} "
      {% endif %}
    </p>

  {%- endmacro -%}


  {# a macro that removes all newline characters, empty spaces, and returns formatted text  #}
    {%- macro cleanup(data) -%}
      {%- for item in data.split("\n")  if item | trim != "" -%}
        {{ item | trim }} {% endfor -%}
  {%- endmacro -%}

  {# a macro to call all macros :)  #}
    {%- macro mother_of_all_macros() -%}
      {{ getReport() }}
    {%- endmacro -%}
    
    {# Call the macro  #}
    {{- cleanup(mother_of_all_macros()) -}}