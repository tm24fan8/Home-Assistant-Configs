input_boolean:
  shower_mode:
    name: Shower Mode
    icon: mdi:shower
  living_room_entertainment_mode:
    name: Living Room Entertainment Mode
    icon: mdi:party-popper
  front_porch_light_on:
    name: Front Porch Light On
    icon: hue:room-outdoors
  living_room_dynamic_scenes:
    name: Living Room Dynamic Scenes
    icon: mdi:animation
  living_room_entertainment_control:
    name: Living Room Entertainment Control
    icon: mdi:television-ambient-light
  delivery_mode:
    name: Delivery Mode
    icon: mdi:pizza
  holiday_mode:
    name: Holiday Mode
    icon: mdi:string-lights
  give_me_darkness:
    name: Give Me Darkness
    icon: mdi:weather-night
  tina_desk_lights:
    name: Tina Desk Lights
    icon: mdi:desk
  holiday_mode_hold:
    name: Holiday Mode Hold
    icon: mdi:party-popper
  christmas_day_show:
    name: Christmas Day Show
    icon: mdi:pine-tree

input_number:
  upstairs_bathroom_motion_off_delay:
    name: Upstairs Bathroom Motion Off Delay
    min: 0
    max: 15
    step: 1
    unit_of_measurement: minutes
    icon: mdi:timer
  front_porch_motion_off_delay:
    name: Front Porch Motion Off Delay
    min: 0
    max: 30
    step: 1
    unit_of_measurement: minutes
    icon: mdi:timer
  downstairs_bathroom_lights_off_delay:
    name: Downstairs Bathroom Lights Off Delay
    min: 0
    max: 60
    step: 1
    unit_of_measurement: minutes
    icon: mdi:timer
  basement_studio_lights_off_delay:
    name: Basement Studio Lights Off Delay
    min: 0
    max: 30
    step: 1
    unit_of_measurement: minutes
    icon: mdi:timer

input_select:
  living_room_scenes:
    name: Living Room Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
      - Energize
      - Concentrate
      - Savanna Sunset
      - Tropical Twilight
      - Tokyo
      - Forest Adventure
      - Painted Sky
    initial: Select
    icon: hue:room-living
  mud_room_scenes:
    name: Mud Room Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
    initial: Select
    icon: hue:room-other
  dining_room_lamp_scenes:
    name: Dining Room Lamp Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
    initial: Select
    icon: mdi:floor-lamp-dual
  upstairs_hallway_scenes:
    name: Upstairs Hallway Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
    initial: Select
    icon: hue:ceiling-round
  kallen_bedroom_scenes:
    name: Kallen Bedroom Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
      - Overhead Nightlight
      - Wall Nightlight
    initial: Select
    icon: mdi:bunk-bed
  emma_bedroom_scenes:
    name: Emma Bedroom Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
    initial: Select
    icon: hue:room-nursery
  basement_studio_scenes:
    name: Basement Studio Scenes
    options:
      - Select
      - Adaptive
      - Energize
      - Concentrate
      - Bright
      - Dimmed
      - Nightlight
      - Relax
      - Purple
      - Pink
      - Kallen Reading
      - Baby Is Napping
      - Stairwell
    initial: Select
    icon: mdi:twitch
  master_bedroom_scenes:
    name: Master Bedroom Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
      - Front Nightlight
      - Side Nightlight
    initial: Select
    icon: mdi:bed
  upstairs_bathroom_scenes:
    name: Upstairs Bathroom Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
      - Single Nightlight
    initial: Select
    icon: mdi:toilet
  downstairs_bathroom_scenes:
    name: Downstairs Bathroom Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Dimmed
      - Nightlight
    initial: Select
    icon: mdi:toilet
  front_porch_scenes:
    name: Front Porch Scenes
    options:
      - Select
      - Adaptive
      - Bright
      - Energize
      - Concentrate
      - Dimmed
      - Nightlight
      - St Patricks Day
      - Halloween
    initial: Select
    icon: hue:room-porch
  tina_lamp_scenes:
    name: Tina Lamp Scenes
    options:
      - Select
      - Adaptive
      - Energize
      - Bright
      - Nightlight
    initial: Select
    icon: hue:room-dining
  tina_desk_scenes:
    name: Tina Desk Scenes
    options:
      - Select
      - Day Mode
      - Evening Mode
      - Night Mode
      - Reset
    initial: Select
    icon: mdi:desk
  holiday_animation:
    name: Holiday Animation
    options:
      - Christmas
      - Halloween
      - St Patricks Day
    icon: mdi:palette

input_text:
  living_room_selected_scene:
    name: Living Room Selected Scene
  mud_room_selected_scene:
    name: Mud Room Selected Scene
  dining_room_lamp_selected_scene:
    name: Dining Room Lamp Selected Scene
  upstairs_hallway_selected_scene:
    name: Upstairs Hallway Selected Scene
  kallen_bedroom_selected_scene:
    name: Kallen Bedroom Selected Scene
  emma_bedroom_selected_scene:
    name: Emma Bedroom Selected Scene
  basement_studio_selected_scene:
    name: Basement Studio Selected Scene
  master_bedroom_selected_scene:
    name: Master Bedroom Selected Scene
  upstairs_bathroom_selected_scene:
    name: Upstairs Bathroom Selected Scene
  downstairs_bathroom_selected_scene:
    name: Downstairs Bathroom Selected Scene
  front_porch_selected_scene:
    name: Front Porch Selected Scene
  tina_lamp_selected_scene:
    name: Tina Lamp Selected Scene
  tina_desk_selected_scene:
    name: Tina Desk Selected Scene

sensor:
  - platform: template
    sensors:
      basement_studio_lights_brightness_actual:
        friendly_name: "Basement Studio Lights - Brightness Actual"
        value_template: >
          {% set current = state_attr('light.basement_studio_lights','brightness') %}
          {{ ((current / 255) * 100) | float | round(2) }}
        availability_template: >
          {% if is_state('light.basement_studio_lights','on') %}
            true
          {% else %}
            false
          {% endif %}
        unit_of_measurement: '%'
        icon_template: mdi:brightness-percent
      basement_studio_lights_brightness_intended:
        friendly_name: "Basement Studio Lights - Brightness Intended"
        value_template: "{{ state_attr('switch.adaptive_lighting_basement_studio','brightness_pct') | float | round(2) }}"
        availability_template: >
          {% if is_state('switch.adaptive_lighting_basement_studio','on') %}
            true
          {% else %}
            false
          {% endif %}
        unit_of_measurement: '%'
        icon_template: mdi:brightness-percent
      basement_studio_lights_colortemp_actual:
        friendly_name: "Basement Studio Lights - Colortemp Actual"
        value_template: "{{ state_attr('light.basement_studio_lights','color_temp_kelvin') | int }}"
        availability_template: >
          {% if is_state('light.basement_studio_lights','on') %}
            true
          {% else %}
            false
          {% endif %}
        unit_of_measurement: 'K'
        icon_template: mdi:thermometer-lines
      basement_studio_lights_colortemp_intended:
        friendly_name: "Basement Studio Lights - Colortemp Intended"
        value_template: "{{ state_attr('switch.adaptive_lighting_basement_studio','color_temp_kelvin') | int }}"
        availability_template: >
          {% if is_state('switch.adaptive_lighting_basement_studio','on') %}
            true
          {% else %}
            false
          {% endif %}
        unit_of_measurement: 'K'
        icon_template: mdi:thermometer-lines
      basement_studio_lights_brightness_diff:
        friendly_name: "Basement Studio Lights - Brightness Diff"
        value_template: >
          {% set current = states('sensor.basement_studio_lights_brightness_actual') | float %}
          {% set intended = states('sensor.basement_studio_lights_brightness_intended') | float %}
          {{ (current - intended) | float | round(2) }}
        availability_template: >
          {% if is_state('light.basement_studio_lights','on') and is_state('switch.adaptive_lighting_basement_studio','on') %}
            true
          {% else %}
            false
          {% endif %}
        unit_of_measurement: '%'
        icon_template: mdi:brightness-percent
      basement_studio_lights_colortemp_diff:
        friendly_name: "Basement Studio Lights - Colortemp Diff"
        value_template: >
          {% set current = states('sensor.basement_studio_lights_colortemp_actual') | float %}
          {% set intended = states('sensor.basement_studio_lights_colortemp_intended') | float %}
          {{ (current - intended) | float | round(2) }}
        availability_template: >
          {% if is_state('light.basement_studio_lights','on') and is_state('switch.adaptive_lighting_basement_studio','on') %}
            true
          {% else %}
            false
          {% endif %}
        unit_of_measurement: 'K'
        icon_template: mdi:thermometer-lines

switch:
  - platform: animated_scenes
    name: Christmas
    restore: False
    restore_power: False
    ignore_off: False
    lights:
      - light.front_porch_light
    colors:
      - color_type: rgb_color
        color: [255,0,0]
        brightness: 255
      - color_type: rgb_color
        color: [0,255,0]
        brightness: 255
    transition: 10
    change_frequency: 60
    change_amount: all
    change_sequence: True
    animate_brightness: True
    animate_color: True
  - platform: animated_scenes
    name: Christmas Day
    restore: False
    restore_power: False
    ignore_off: False
    lights:
      - light.living_room_color_1
      - light.living_room_color_2
      - light.living_room_color_3
      - light.tina_lamp_top
      - light.tina_lamp_side
      - light.tina_desk_strip
    colors:
      - color_type: rgb_color
        color: [255,0,0]
        brightness: 255
      - color_type: rgb_color
        color: [0,255,0]
        brightness: 255
    transition: 1
    change_frequency: 5
    change_amount: 3
    change_sequence: False
    animate_brightness: True
    animate_color: True

automation:
  - id: 477e6e8a-4e33-4268-8c2d-f39902c0d64f
    alias: Living Room Night Lighting
    description: Provide lighting in case anyone needs to go downstairs in the middle of the night.
    trigger:
      - platform: state
        entity_id: binary_sensor.living_room_motion
        from: 'off'
        to: 'on'
        id: motion-on
      - platform: state
        entity_id: binary_sensor.living_room_motion
        from: 'on'
        to: 'off'
        for:
          hours: 0
          minutes: 10
          seconds: 0
        id: motion-off
    condition:
      - condition: state
        entity_id: binary_sensor.people_present
        state: 'on'
      - condition: state
        entity_id: input_boolean.night_mode
        state: 'on'
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'off'
    action:
      - if:
        - condition: trigger
          id: motion-on
        then:
          - service: light.turn_on
            target:
              entity_id: light.first_floor_lights
          - service: input_select.select_option
            target:
              entity_id:
                - input_select.living_room_scenes
                - input_select.tina_lamp_scenes
                - input_select.mud_room_scenes
                - input_select.downstairs_bathroom_scenes
                - input_select.dining_room_lamp_scenes
            data:
              option: Adaptive
      - if:
        - condition: trigger
          id: motion-off
        then:
          - service: light.turn_off
            target:
              entity_id: light.first_floor_lights

  - id: b897d714-bbf2-44ce-afaf-63cf3694351c
    alias: Tina Desk Lights Handler
    description: Handles turning on the desk lights with smart scene selection and also turning them off
    mode: single
    trigger:
      - platform: state
        entity_id: input_boolean.tina_desk_lights
        from: 'off'
        to: 'on'
        id: toggle-on
      - platform: state
        entity_id: input_boolean.tina_desk_lights
        from: 'on'
        to: 'off'
        id: toggle-off
      - platform: state
        entity_id: input_select.tina_desk_scenes
        to: 'Reset'
        id: reset
      - platform: state
        entity_id: light.tina_desk_lights
        from: 'on'
        to: 'off'
        id: lights-off
      - platform: state
        entity_id: light.tina_desk_lights
        from: 'off'
        to: 'on'
        id: lights-on
    action:
      - if:
        - condition: or
          conditions:
          - condition: trigger
            id: toggle-on
          - condition: trigger
            id: reset
        then:
        - if:
          - condition: state
            entity_id: binary_sensor.early_night_mode
            state: 'off'
          then:
          - service: input_select.select_option
            target:
              entity_id: input_select.tina_desk_scenes
            data:
              option: Day Mode
        - if:
          - condition: and
            conditions:
              - condition: state
                entity_id: binary_sensor.early_night_mode
                state: 'on'
              - condition: state
                entity_id: input_boolean.give_me_darkness
                state: 'off'
          then:
          - service: input_select.select_option
            target:
              entity_id: input_select.tina_desk_scenes
            data:
              option: Evening Mode
        - if:
          - condition: state
            entity_id: input_boolean.give_me_darkness
            state: 'on'
          then:
          - service: input_select.select_option
            target:
              entity_id: input_select.tina_desk_scenes
            data:
              option: Night Mode
      - if:
        - condition: trigger
          id: toggle-off
        then:
        - service: light.turn_off
          target:
            entity_id: light.tina_desk_lights
      - if:
        - condition: trigger
          id: lights-off
        then:
        - if:
          - condition: state
            entity_id: input_boolean.tina_desk_lights
            state: 'on'
          then:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.tina_desk_lights
      - if:
        - condition: trigger
          id: lights-on
        then:
        - if:
          - condition: state
            entity_id: input_boolean.tina_desk_lights
            state: 'off'
          then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.tina_desk_lights
          - delay:
              seconds: 2
          # The delay is to prevent the boolean from re-running the automation if the lights were turned on manually

  - id: 47645bcf-a6ed-4c34-8ece-8daed4b10d9a
    alias: Basement Door Handling
    description: Turns on lights in basement when door is opened, if not already on
    mode: restart
    trigger:
      - platform: state
        entity_id: binary_sensor.basement_studio_door
        from: 'off'
        to: 'on'
        id: door-open
      - platform: state
        entity_id: binary_sensor.basement_studio_door
        from: 'on'
        to: 'off'
        id: door-closed
      - platform: event
        event_type: timer.finished
        event_data:
          entity_id: timer.basement_studio_door_timer
        id: timer-finished
      - platform: state
        entity_id:
          - binary_sensor.tony_desktop_on
          - binary_sensor.kallen_desktop_on
        from: 'off'
        to: 'on'
        id: computers-on
    condition:
      - condition: state
        entity_id: input_boolean.studio_quiet
        state: 'off'
    action:
      choose:
      - conditions:
        - condition: trigger
          id: door-open
        sequence:
        - if:
          - condition: state
            entity_id: light.basement_studio_lights
            state: 'off'
          then:
          - service: light.turn_on
            target:
              entity_id: light.basement_studio_lights
        - service: timer.cancel
          target:
            entity_id: timer.basement_studio_door_timer
        - delay:
            seconds: 1
        - service: input_select.select_option
          target:
            entity_id: input_select.basement_studio_scenes
          data:
            option: Adaptive
      - conditions:
        - condition: trigger
          id: door-closed
        sequence:
        - if:
          - condition: and
            conditions:
            - condition: state
              entity_id: binary_sensor.tony_desktop_on
              state: 'off'
            - condition: state
              entity_id: binary_sensor.kallen_desktop_on
              state: 'off'
          then:
          - service: timer.start
            target:
              entity_id: timer.basement_studio_door_timer
            data:
              duration: "{{ (states('input_number.basement_studio_lights_off_delay') | int ) * 60 }}"
      - conditions:
        - condition: trigger
          id: computers-on
        sequence:
        - service: timer.cancel
          target:
            entity_id: timer.basement_studio_door_timer
      - conditions:
        - condition: trigger
          id: timer-finished
        sequence:
        - service: light.turn_off
          target:
            entity_id: light.basement_studio_lights


script:
  adaptive_on_first_floor:
    alias: Adaptive on First Floor
    sequence:
      - if:
        - condition: state
          entity_id: light.living_room_lights
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.living_room_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_living_room
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_living_room
        - service: input_text.set_value
          target:
            entity_id: input_text.living_room_selected_scene
          data:
            value: Adaptive
      - if:
        - condition: state
          entity_id: light.dining_room_lamp
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.dining_room_lamp_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_dining_room_lamp
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_dining_room_lamp
        - service: input_text.set_value
          target:
            entity_id: input_text.dining_room_lamp_selected_scene
          data:
            value: Adaptive
      - if:
        - condition: or
          conditions:
            - condition: state
              entity_id: light.tina_lamp
              state: 'on'
            - condition: state
              entity_id: light.tina_desk_strip
              state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.tina_desk_scenes
          data:
            option: Reset
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_tina_lamp
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_tina_lamp
      - if:
        - condition: state
          entity_id: light.downstairs_bathroom_lights
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.downstairs_bathroom_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_downstairs_bathroom
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_downstairs_bathroom
        - service: input_text.set_value
          target:
            entity_id: input_text.downstairs_bathroom_selected_scene
          data:
            value: Adaptive
      - if:
        - condition: state
          entity_id: light.mud_room_overhead
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.mud_room_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_mud_room
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_mud_room
        - service: input_text.set_value
          target:
            entity_id: input_text.mud_room_selected_scene
          data:
            value: Adaptive

  adaptive_on_second_floor:
    alias: 'Adaptive on Second Floor'
    sequence:
      - if:
        - condition: state
          entity_id: light.hallway_overhead
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.upstairs_hallway_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_upstairs_hallway
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_upstairs_hallway
        - service: input_text.set_value
          target:
            entity_id: input_text.upstairs_hallway_selected_scene
          data:
            value: Adaptive
      - if:
        - condition: state
          entity_id: light.master_bedroom_lights
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.master_bedroom_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_master_bedroom
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_master_bedroom
        - service: input_text.set_value
          target:
            entity_id: input_text.master_bedroom_selected_scene
          data:
            value: Adaptive
      - if:
        - condition: state
          entity_id: light.kallen_bedroom_lights
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.kallen_bedroom_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_kallen_bedroom
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_kallen_bedroom
        - service: input_text.set_value
          target:
            entity_id: input_text.kallen_bedroom_selected_scene
          data:
            value: Adaptive
      - if:
        - condition: state
          entity_id: light.emma_bedroom_light
          state: 'on'
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.emma_bedroom_scenes
          data:
            option: Adaptive
        else:
        - service: switch.turn_on
          target:
            entity_id: switch.adaptive_lighting_emma_bedroom
        - service: switch.turn_off
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_emma_bedroom
        - service: input_text.set_value
          target:
            entity_id: input_text.emma_bedroom_selected_scene
          data:
            value: Adaptive
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.shower_mode
            state: 'on'
          sequence:
            - stop: "Shower mode is on"
        - conditions:
          - condition: state
            entity_id: binary_sensor.upstairs_bathroom_motion
            state: 'on'
          sequence:
          - service: input_select.select_option
            target:
              entity_id: input_select.upstairs_bathroom_scenes
            data:
              option: Adaptive
        - conditions:
          - condition: template
            value_template: "{{ is_state('binary_sensor.upstairs_bathroom_motion','off') and is_state('timer.upstairs_bathroom_motion_timer','active') }}"
          sequence:
          - service: timer.finish
            target:
              entity_id: timer.upstairs_bathroom_motion_timer
        default:
        - if:
          - condition: state
            entity_id: binary_sensor.early_night_mode
            state: 'on'
          then:
          - service: input_select.select_option
            target:
              entity_id: input_select.upstairs_bathroom_scenes
            data:
              option: Nightlight
          else:
          - service: light.turn_off
            target:
              entity_id: light.upstairs_bathroom_lights
          - service: switch.turn_on
            target:
              entity_id: switch.adaptive_lighting_upstairs_bathroom
          - service: switch.turn_off
            target:
              entity_id: switch.adaptive_lighting_sleep_mode_upstairs_bathroom
          - service: input_text.set_value
            target:
              entity_id: input_text.upstairs_bathroom_selected_scene
            data:
              value: Adaptive

  bright_on_first_floor:
    alias: 'Bright on First Floor'
    sequence:
      - service: light.turn_on
        target:
          entity_id:
            - light.living_room_lights
            - light.downstairs_bathroom_lights
            - light.dining_room_lamp
            - light.mud_room_overhead
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.tina_desk_lights
      - delay:
          seconds: 1
      - service: input_select.select_option
        target:
          entity_id:
            - input_select.living_room_scenes
            - input_select.downstairs_bathroom_scenes
            - input_select.mud_room_scenes
            - input_select.dining_room_lamp_scenes
        data:
          option: Bright
      - service: light.turn_on
        target:
          entity_id:
            - light.tina_desk_strip
            - light.tina_lamp
        data:
          color_temp_kelvin: 2700
      - service: light.turn_on
        target:
          entity_id: 
            - light.tina_lamp
            - light.tina_desk_strip
        data:
          brightness: 255

  bright_on_second_floor:
    alias: 'Bright on Second Floor'
    sequence:
      - service: light.turn_on
        target:
          entity_id:
            - light.hallway_overhead
            - light.master_bedroom_lights
            - light.upstairs_bathroom_lights
      - if:
        - condition: state
          entity_id: input_boolean.kallen_sleeping
          state: 'off'
        then:
        - service: light.turn_on
          target:
            entity_id: light.kallen_bedroom_lights
      - if:
        - condition: state
          entity_id: input_boolean.emma_sleeping
          state: 'off'
        then:
        - service: light.turn_on
          target:
            entity_id: light.emma_bedroom_light
      - delay:
          seconds: 1
      - service: input_select.select_option
        target:
          entity_id:
            - input_select.upstairs_hallway_scenes
            - input_select.upstairs_bathroom_scenes
            - input_select.master_bedroom_scenes
        data:
          option: Bright
      - if:
        - condition: template
          value_template: >
            {% if is_state('input_boolean.kallen_sleeping','off') %}
              true
            {% elif is_state('input_boolean.kallen_sleeping','on') and is_state('light.kallen_bedroom_lights','on') %}
              true
            {% else %}
              false
            {% endif %}
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.kallen_bedroom_scenes
          data:
            option: Bright
      - if:
        - condition: template
          value_template: >
            {% if is_state('input_boolean.emma_sleeping','off') %}
              true
            {% elif is_state('input_boolean.emma_sleeping','on') and is_state('light.emma_bedroom_light','on') %}
              true
            {% else %}
              false
            {% endif %}
        then:
        - service: input_select.select_option
          target:
            entity_id: input_select.emma_bedroom_scenes
          data:
            option: Bright

  evening_on_first_floor:
    alias: 'Evening on First Floor'
    sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.early_night_mode
            state: 'off'
          sequence:
          - stop: "This scene does nothing during daytime"
        - conditions:
          - condition: state
            entity_id: input_boolean.give_me_darkness
            state: 'on'
          sequence:
          - service: input_select.select_option
            target:
              entity_id:
                - input_select.mud_room_scenes
                - input_select.dining_room_lamp_scenes
            data:
              option: Nightlight
          - if:
            - condition: state
              entity_id: person.christina_stork
              state: home
            then:
            - service: input_select.select_option
              target:
                entity_id: input_select.tina_desk_scenes
              data:
                option: Night Mode
          - choose:
            - conditions:
              - condition: state
                entity_id: input_boolean.guest_mode
                state: 'off'
              sequence:
              - service: light.turn_off
                target:
                  area_id:
                  - living_room
                  - downstairs_bathroom
            - conditions:
              - condition: state
                entity_id: input_boolean.guest_mode
                state: 'on'
              sequence:
              - service: light.turn_off
                target:
                  area_id:
                  - downstairs_bathroom
        - conditions:
          - condition: state
            entity_id: input_boolean.give_me_darkness
            state: 'off'
          sequence:
          - service: light.turn_off
            target:
              entity_id:
                - light.dining_room_lamp
                - light.downstairs_bathroom_lights
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.tina_desk_lights
          - service: light.turn_on
            target:
              entity_id: 
                - light.living_room_lights
                - light.mud_room_overhead
          - service: input_select.select_option
            target:
              entity_id:
                - input_select.living_room_scenes
                - input_select.mud_room_scenes
            data:
              option: Adaptive

  evening_on_second_floor:
    alias: 'Evening on Second Floor'
    sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.early_night_mode
            state: 'off'
          sequence:
          - stop: "This scene does nothing during daytime"
        - conditions:
          - condition: state
            entity_id: input_boolean.give_me_darkness
            state: 'on'
          sequence:
          - service: input_select.select_option
            target:
              entity_id:
              - input_select.upstairs_hallway_scenes
            data:
              option: Nightlight
          - service: input_select.select_option
            target:
              entity_id: input_select.upstairs_bathroom_scenes
            data:
              option: >
                {% if is_state('binary_sensor.upstairs_bathroom_motion','on') %}
                  Adaptive
                {% elif is_state('timer.upstairs_bathroom_motion_timer','active') %}
                  Adaptive
                {% else %}
                  Nightlight
                {% endif %}
          - service: light.turn_off
            target:
              area_id:
              - kallen_bedroom
              - master_bedroom
              - emma_bedroom
        - conditions:
          - condition: state
            entity_id: input_boolean.give_me_darkness
            state: 'off'
          sequence:
          - service: light.turn_off
            target:
              area_id:
              - master_bedroom
              - kallen_bedroom
              - emma_bedroom
              - upstairs_hallway
          - service: input_select.select_option
            target:
              entity_id: input_select.upstairs_bathroom_scenes
            data:
              option: >
                {% if is_state('binary_sensor.upstairs_bathroom_motion','on') %}
                  Adaptive
                {% elif is_state('timer.upstairs_bathroom_motion_timer','active') %}
                  Adaptive
                {% else %}
                  Nightlight
                {% endif %}

  morning_scene:
    alias: 'Morning Scene'
    sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.master_bedroom_sleeping
      - if:
        - condition: numeric_state
          entity_id: sensor.pirateweather_cloud_coverage
          above: 50
        then:
        - if:
          - condition: template
            value_template: "{{ is_state('input_boolean.kallen_sleeping','off') and is_state('person.kallen_stork','home') }}"
          then:
          - service: light.turn_on
            target:
              entity_id: light.kallen_bedroom_lights
        - if:
          - condition: state
            entity_id: input_boolean.emma_sleeping
            state: 'off'
          then:
          - service: light.turn_on
            target:
              entity_id: light.emma_bedroom_light

#! Unless there is a good reason, do not define multi-room scenes below.
#! Use scripts instead, to avoid some straight-up haunted house bullshit...

scene:
  - name: Adaptive in Living Room
    icon: mdi:palette
    entities:
      light.living_room_lights:
        state: "on"
      input_select.living_room_scenes:
        state: "Adaptive"
  - name: Bright in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Bright"
  - name: Dimmed in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Dimmed"
  - name: Nightlight in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Nightlight"
  - name: Energize in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Energize"
  - name: Concentrate in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Concentrate"
  - name: Savanna Sunset in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Savanna Sunset"
  - name: Tropical Twilight in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Tropical Twilight"
  - name: Tokyo in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Tokyo"
  - name: Forest Adventure in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Forest Adventure"
  - name: Painted Sky in Living Room
    icon: mdi:palette
    entities:
      input_select.living_room_scenes:
        state: "Painted Sky"
  - name: Adaptive in Downstairs Bathroom
    icon: mdi:palette
    entities:
      light.downstairs_bathroom_lights:
        state: "on"
      input_select.downstairs_bathroom_scenes:
        state: "Adaptive"
  - name: Bright in Downstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.downstairs_bathroom_scenes:
        state: "Bright"
  - name: Dimmed in Downstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.downstairs_bathroom_scenes:
        state: "Dimmed"
  - name: Nightlight in Downstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.downstairs_bathroom_scenes:
        state: "Nightlight"
  - name: Adaptive in Dining Room Lamp
    icon: mdi:palette
    entities:
      input_select.dining_room_lamp_scenes:
        state: "Adaptive"
  - name: Bright in Dining Room Lamp
    icon: mdi:palette
    entities:
      input_select.dining_room_lamp_scenes:
        state: "Bright"
  - name: Dimmed in Dining Room Lamp
    icon: mdi:palette
    entities:
      input_select.dining_room_lamp_scenes:
        state: "Dimmed"
  - name: Nightlight in Dining Room Lamp
    icon: mdi:palette
    entities:
      input_select.dining_room_lamp_scenes:
        state: "Nightlight"
  - name: Day Mode in Tina Desk
    icon: mdi:palette
    entities:
      light.tina_lamp_top:
        state: "on"
      light.tina_lamp_side:
        state: "off"
      light.tina_desk_strip:
        state: "on"
        rgb_color:
          - 0
          - 255
          - 255
        brightness: 89
      input_select.tina_lamp_scenes:
        state: "Adaptive"
  - name: Evening Mode in Tina Desk
    icon: mdi:palette
    entities:
      light.tina_lamp:
        state: "on"
      input_select.tina_lamp_scenes:
        state: "Adaptive"
      light.tina_desk_strip:
        state: "on"
        rgb_color:
          - 127
          - 0
          - 255
        brightness: 128
  - name: Night Mode in Tina Desk
    icon: mdi:palette
    entities:
      switch.adaptive_lighting_tina_lamp:
        state: "off"
      light.tina_lamp:
        state: "on"
        rgb_color:
          - 127
          - 0
          - 255
        brightness: 51
      light.tina_desk_strip:
        state: "on"
        rgb_color:
          - 127
          - 0
          - 255
        brightness: 128
  - name: Adaptive in Tina Lamp
    icon: mdi:palette
    entities:
      light.tina_lamp:
        state: "on"
      input_select.tina_lamp_scenes:
        state: "Adaptive"
  - name: Energize in Tina Lamp
    icon: mdi:palette
    entities:
      input_select.tina_lamp_scenes:
        state: "Energize"
  - name: Bright in Tina Lamp
    icon: mdi:palette
    entities:
      input_select.tina_lamp_scenes:
        state: "Bright"
  - name: Nightlight in Tina Lamp
    icon: mdi:palette
    entities:
      input_select.tina_lamp_scenes:
        state: "Nightlight"
  - name: Adaptive in Mud Room
    icon: mdi:palette
    entities:
      light.mud_room_overhead:
        state: "on"
      input_select.mud_room_scenes:
        state: "Adaptive"
  - name: Bright in Mud Room
    icon: mdi:palette
    entities:
      input_select.mud_room_scenes:
        state: "Bright"
  - name: Dimmed in Mud Room
    icon: mdi:palette
    entities:
      input_select.mud_room_scenes:
        state: "Dimmed"
  - name: Nightlight in Mud Room
    icon: mdi:palette
    entities:
      input_select.mud_room_scenes:
        state: "Nightlight"
  - name: Adaptive in Upstairs Hallway
    icon: mdi:palette
    entities:
      light.hallway_overhead:
        state: "on"
      input_select.upstairs_hallway_scenes:
        state: "Adaptive"
  - name: Bright in Upstairs Hallway
    icon: mdi:palette
    entities:
      input_select.upstairs_hallway_scenes:
        state: "Bright"
  - name: Dimmed in Upstairs Hallway
    icon: mdi:palette
    entities:
      input_select.upstairs_hallway_scenes:
        state: "Dimmed"
  - name: Nightlight in Upstairs Hallway
    icon: mdi:palette
    entities:
      input_select.upstairs_hallway_scenes:
        state: "Nightlight"
  - name: Adaptive in Upstairs Bathroom
    icon: mdi:palette
    entities:
      light.upstairs_bathroom_lights:
        state: "on"
      input_select.upstairs_bathroom_scenes:
        state: "Adaptive"
  - name: Bright in Upstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.upstairs_bathroom_scenes:
        state: "Bright"
  - name: Dimmed in Upstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.upstairs_bathroom_scenes:
        state: "Dimmed"
  - name: Nightlight in Upstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.upstairs_bathroom_scenes:
        state: "Nightlight"
  - name: Single Nightlight in Upstairs Bathroom
    icon: mdi:palette
    entities:
      input_select.upstairs_bathroom_scenes:
        state: "Single Nightlight"
  - name: Adaptive in Master Bedroom
    icon: mdi:palette
    entities:
      light.master_bedroom_lights:
        state: "on"
      input_select.master_bedroom_scenes:
        state: "Adaptive"
  - name: Bright in Master Bedroom
    icon: mdi:palette
    entities:
      input_select.master_bedroom_scenes:
        state: "Bright"
  - name: Dimmed in Master Bedroom
    icon: mdi:palette
    entities:
      input_select.master_bedroom_scenes:
        state: "Dimmed"
  - name: Nightlight in Master Bedroom
    icon: mdi:palette
    entities:
      input_select.master_bedroom_scenes:
        state: "Nightlight"
  - name: Front Nightlight in Master Bedroom
    icon: mdi:palette
    entities:
      input_select.master_bedroom_scenes:
        state: "Front Nightlight"
  - name: Side Nightlight in Master Bedroom
    icon: mdi:palette
    entities:
      input_select.master_bedroom_scenes:
        state: "Side Nightlight"
  - name: Adaptive in Kallen Bedroom
    icon: mdi:palette
    entities:
      light.kallen_bedroom_lights:
        state: "on"
      input_select.kallen_bedroom_scenes:
        state: "Adaptive"
  - name: Bright in Kallen Bedroom
    icon: mdi:palette
    entities:
      input_select.kallen_bedroom_scenes:
        state: "Bright"
  - name: Dimmed in Kallen Bedroom
    icon: mdi:palette
    entities:
      input_select.kallen_bedroom_scenes:
        state: "Dimmed"
  - name: Nightlight in Kallen Bedroom
    icon: mdi:palette
    entities:
      input_select.kallen_bedroom_scenes:
        state: "Nightlight"
  - name: Overhead Nightlight in Kallen Bedroom
    icon: mdi:palette
    entities:
      input_select.kallen_bedroom_scenes:
        state: "Overhead Nightlight"
  - name: Wall Nightlight in Kallen Bedroom
    icon: mdi:palette
    entities:
      input_select.kallen_bedroom_scenes:
        state: "Wall Nightlight"
  - name: Adaptive in Emma Bedroom
    icon: mdi:palette
    entities:
      light.emma_bedroom_light:
        state: "on"
      input_select.emma_bedroom_scenes:
        state: "Adaptive"
  - name: Bright in Emma Bedroom
    icon: mdi:palette
    entities:
      input_select.emma_bedroom_scenes:
        state: "Bright"
  - name: Dimmed in Emma Bedroom
    icon: mdi:palette
    entities:
      input_select.emma_bedroom_scenes:
        state: "Dimmed"
  - name: Nightlight in Emma Bedroom
    icon: mdi:palette
    entities:
      input_select.emma_bedroom_scenes:
        state: "Nightlight"
  - name: Adaptive in Basement Studio
    icon: mdi:palette
    entities:
      light.basement_studio_lights:
        state: "on"
      input_select.basement_studio_scenes:
        state: "Adaptive"
  - name: Energize in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Energize"
  - name: Concentrate in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Concentrate"
  - name: Bright in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Bright"
  - name: Dimmed in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Dimmed"
  - name: Nightlight in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Nightlight"
  - name: Relax in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Relax"
  - name: Purple in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Purple"
  - name: Pink in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Pink"
  - name: Kallen Reading in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Kallen Reading"
  - name: Baby Is Napping in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Baby Is Napping"
  - name: Stairwell in Basement Studio
    icon: mdi:palette
    entities:
      input_select.basement_studio_scenes:
        state: "Stairwell"